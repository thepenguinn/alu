\ctikzsubcircuitdef{subctkmsFlipFlop} {
    d, rst, reclk, feclk, q, qbar,
    bd, brst, breclk, bfeclk, bq, bqbar%
} {
    node (#1) [msFlipFlop, anchor = lpin 1]{}%
    \markcoordinate {#1} {d}     {lpin 2}
    \markcoordinate {#1} {rst}   {bpin 2}
    \markcoordinate {#1} {reclk}  {tpin 1}
    \markcoordinate {#1} {feclk} {tpin 2}
    \markcoordinate {#1} {q}     {rpin 1}
    \markcoordinate {#1} {qbar}  {rpin 2}%
    (#1-bd) node[circleinv, fill = circleinvfillcolor, anchor = apex] {}
    (#1-breclk) node[circleinv, fill = circleinvfillcolor, anchor = bottom] {}
    (#1-bfeclk) node[circleinv, fill = circleinvfillcolor, anchor = bottom] {}
    (#1-bqbar) node[circleinv, fill = circleinvfillcolor, anchor = left] {}
}

\ctikzsubcircuitactivate{subctkmsFlipFlop}

\newcommand\msFlipFlop[3] {
    \subctkmsFlipFlop{#1} {#2}
    (#1.center) node[]{#3}
}

\ctikzsubcircuitdef{subctkedgeDetector} {
    clk, reclk,
    bclk, breclk%
} {
    node (#1) [edgeDetector, anchor = lpin 1]{}%
    \markcoordinate {#1} {clk}     {lpin 1}
    \markcoordinate {#1} {reclk}   {rpin 1}
    (#1-breclk) node[circleinv, fill = circleinvfillcolor, anchor = left] {}
}

\ctikzsubcircuitactivate{subctkedgeDetector}

\newcommand\edgeDetector[3] {
    \subctkedgeDetector{#1} {#2}
    (#1.center) node[]{#3}
}
